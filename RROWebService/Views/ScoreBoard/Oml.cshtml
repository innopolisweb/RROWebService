@model RROWebService.Models.Categories.Oml.OmlViewModel

@section THeader
    {
    <div class="table-header-row">
        <tr>
            <th colspan="1" rowspan="5">№</th>
            <th colspan="1" rowspan="5">Код команды</th>
            <th colspan="13">ЗАДАЧИ</th>
            <th colspan="2">ШТРАФ</th>
            <th colspan="2">ВРЕМЯ</th>
            <th colspan="1">ПОДПИСЬ</th>
        </tr>

        <tr>
            <th colspan="7">Доставка пассажиров</th>
            <th colspan="2">Посетитель зоопарка</th>
            <th colspan="3">Батарейный блок</th>
            <th colspan="1">Робот</th>
            <th colspan="2">Стена</th>
            <th colspan="1" rowspan="4">Секундомер</th>
            <th colspan="1" rowspan="4">в формате ММ:СС,ДС</th>
            <th colspan="1" rowspan="4">РЕЗУЛЬТАТЫ ПОПЫТКИ ЗАПИСАНЫ ВЕРНО</th>
        </tr>

        <tr>
            <th colspan="2" rowspan="3">Пассажир</th>
            <th colspan="3">Находится в ВЕРНОЙ зоне</th>
            <th colspan="2">Находится в НЕВЕРНОЙ зоне</th>
            <th colspan="1" rowspan="3">Посетитель</th>
            <th colspan="1" rowspan="2">в исходной зоне</th>
            <th colspan="1" rowspan="3">Батарейный блок</th>
            <th colspan="2">Находится в зоне батареи</th>
            <th colspan="1" rowspan="3">находится в зоне старта-финиша ПОЛНОСТЬЮ остановился</th>
            <th colspan="1" rowspan="3">Стена</th>
            <th colspan="1" rowspan="3">не повреждена и НЕ смещена</th>
        </tr>

        <tr>
            <th colspan="2">ПОЛНОСТЬЮ</th>
            <th colspan="1" rowspan="2">ЧАСТИЧНО</th>
            <th colspan="2">ПОЛНОСТЬЮ</th>
            <th colspan="1" rowspan="2">ПОЛНОСТЬЮ</th>
            <th colspan="1" rowspan="2">ЧАСТИЧНО</th>
        </tr>

        <tr>
            <th colspan="1">Стоит</th>
            <th colspan="1">НЕ стоит</th>
            <th colspan="1">Стоит</th>
            <th colspan="1">НЕ стоит</th>
            <th colspan="1">Стоит</th>
        </tr>
    </div>
}

@foreach (var team in Model.Teams)
{
    <div class="table-data-row">
        <tr>
            <td rowspan="5">1</td>
            <td rowspan="5">@team.TeamId</td>
            <td>Красный</td>
            <td>Взрослый</td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="5">Синий</td>
            <td rowspan="5">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="3">№1</td>
            <td rowspan="3">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="3">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="5">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="3">угловая</td>
            <td rowspan="3">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="3">№1</td>
            <td rowspan="3">
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text">
                    <label class="mdl-textfield__label">Время..</label>
                </div>
            </td>
            <td rowspan="5">
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                    <div class="submit-btn">СОГЛАСЕН</div>
                </button>
            </td>
        </tr>
        <tr>
            <td>Желтый</td>
            <td>Ребенок</td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
        </tr>
        <tr>
            <td>Зеленый</td>
            <td>Взрослый</td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
        </tr>
        <tr>
            <td rowspan="2">Белый</td>
            <td>Взрослый</td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="2">№1</td>
            <td rowspan="2">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="2">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="2">прямая</td>
            <td rowspan="2">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td rowspan="2">№2</td>
            <td rowspan="2">
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text">
                    <label class="mdl-textfield__label">Баллы..</label>
                </div>
            </td>
        </tr>
        <tr>
            <td>Ребенок</td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
            <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                    <input type="checkbox" class="mdl-checkbox__input">
                </label>
            </td>
        </tr>
    </div>
}

@section Scripts
    {
    <script>
        function submitteam(elem) {
            elem.innerHTML = "Сохранение...";
            var btclass = elem.classList[0];
            var elements = document.getElementsByClassName(btclass);
            var jsonbody = '{';
            jsonbody += '"teamId":' + '"' + btclass + '"' + ',';
            jsonbody += '"polygon":"@Model.Polygon",';
            jsonbody += '"round":"@Model.CurrentRound",';
            var element0 = (elements[0].value === "" ? 'null' : '"' + elements[0].value + '"');
            var element1 = (elements[1].value === "" ? 'null' : '"' + elements[1].value + '"');
            var element2 = (elements[2].value === "" ? 'null' : '"' + elements[2].value + '"');
            var element3 = (elements[3].value === "" ? 'null' : '"' + elements[3].value + '"');
            var element4 = (elements[4].value === "" ? 'null' : '"' + elements[4].value + '"');
            var element5 = (elements[5].value === "" ? 'null' : '"' + elements[5].value + '"');
            var element10 = (elements[10].value === "" ? 'null' : '"' + elements[10].value + '"');

            jsonbody += '"staysCorrectly":' + element0 + ',';
            jsonbody += '"liesCorrectly":' + element1 + ',';
            jsonbody += '"partiallyCorrect":' + element2 + ',';
            jsonbody += '"staysIncorrectly":' + element3 + ',';
            jsonbody += '"liesIncorrectly":' + element4 + ',';
            jsonbody += '"none":' + element5 + ',';

            if (elements[6].value === "Стоит в зел. зоне + касается синей исходной зоны или серого контура")
                jsonbody += '"blueBlockState":"1",';
            else if (elements[6].value === "Не выполянет условия начисления баллов")
                jsonbody += '"blueBlockState":"0",';
            else jsonbody += '"blueBlockState":null,';

            if (elements[7].value === "Полностью в зоне батареи")
                jsonbody += '"blackBlockState":"2",';
            else if (elements[7].value === "Частично в зоне батареи")
                jsonbody += '"blackBlockState":"1",';
            else if (elements[7].value === "Не в зоне")
                jsonbody += '"blackBlockState":"0",';
            else jsonbody += '"blackBlockState":null,';


            if (elements[8].parentNode.classList.contains("is-checked"))
                jsonbody += '"finishCorrectly":"1",';
            else jsonbody += '"finishCorrectly":"0",';

            if (elements[9].parentNode.classList.contains("is-checked"))
                jsonbody += '"brokenWall":"1",';
            else jsonbody += '"brokenWall":"0",';

            jsonbody += '"timeMils":' + element10 + ',';
            jsonbody += '"saved":"1"}';

            console.log(jsonbody);

            //post request
            var reqest = new XMLHttpRequest();
            reqest.open("post", "http://localhost:5000/api/omlResult", true);
            reqest.setRequestHeader('Content-type', 'application/json; charset=utf-8');
            reqest.onreadystatechange = function () {
                switch (reqest.readyState) {
                    case 1:
                    case 2:
                    case 3:
                        elem.innerHTML = "Сохранение...";
                        break;
                    case 4:
                        if (reqest.status === 200) {
                            elem.innerHTML = "Сохранено";
                            elem.disabled = true;
                            elements[0].disabled = true;
                            elements[1].disabled = true;
                            elements[2].disabled = true;
                            elements[3].disabled = true;
                            elements[4].disabled = true;
                            elements[5].disabled = true;
                            elements[6].disabled = true;
                            elements[7].disabled = true;
                            elements[8].disabled = true;
                            elements[9].disabled = true;
                            elements[10].disabled = true;
                        } else {
                            alert("Error occured");
                            elem.innerHTML = "Сохранить";
                        }
                        break;
                }
            };
            reqest.send(jsonbody);
        }
    </script>
}